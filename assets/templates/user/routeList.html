{% extends "user/base.html" %}
{% block content %}
{% load static %}

<section class="ftco-section">
    <div class="container">
        <div class="row justify-content-center pb-4">
            <div class="col-md-12 heading-section text-center ftco-animate">
                <span class="subheading">Flight Routes</span>
                <div class="d-flex justify-content-between align-items-center">
                    <a class="btn btn-primary" href="{% url 'user_dashboard' %}">Go Back</a>
                    <h2 class="mb-4">Flights based on your search</h2>
                    <a class="btn btn-primary" href="{% url 'user_dashboard' %}">Filter</a>
                </div>
            </div>
        </div>
        <div class="row d-flex">
            {% if fl_details_list %}
                {% for fl_details in fl_details_list %}
                <div class="col-md-12 d-flex ftco-animate flightList_Item rounded shadow">
                    <div class="text">
                        <div class="flightList_ImgCtn">
                            {% if fl_details.airline == 0.0 %}
                                <img class="w-100 rounded shadow " src="{% static "mainTheme/images/air_asia.png" %}"/>
                            {% elif fl_details.airline == 1.0 %}
                                <img class="w-100 rounded shadow" src="{% static "mainTheme/images/air_india_circle.png" %}"/>
                            {% elif fl_details.airline == 2.0 %}
                                <img class="w-100 rounded shadow" src="{% static "mainTheme/images/go_first.png" %}"/>
                            {% elif fl_details.airline == 3.0 %}
                                <img class="w-100 rounded shadow" src="{% static "mainTheme/images/indigo.png" %}"/>
                            {% elif fl_details.airline == 4.0 %}
                                <img class="w-100 rounded shadow" src="{% static "mainTheme/images/spicejet_circle.png" %}"/>
                            {% elif fl_details.airline == 5.0 %}
                                <img class="w-100 rounded shadow" src="{% static "mainTheme/images/vistara_circle.png" %}"/>
                            {% endif %}
                        </div>
                        {% comment %} <h3 class="heading"><a href="#">Indigo</a></h3> {% endcomment %}
                    </div>
                    <form class="row" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="col-md-12 tab-wrap mb-3">
                            <div class="tab-content" id="v-pills-tabContent">
                                <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel" aria-labelledby="v-pills-nextgen-tab">
                                    <div action="#" class="search-property-1">
                                        <div class="row no-gutters">
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Airline</label>
                                                    <div class="form-field">
                                                        <select name="airline" id="" class="form-control">
                                                            <option value="{{fl_details.airline}}">{{fl_details.airline}}</option>
                                                        </select>
                                                        {% if fl_details.airline == 0.0 %}
                                                            <p>Air Asia</p>
                                                        {% elif fl_details.airline == 1.0 %}
                                                            <p>Air India</p>
                                                        {% elif fl_details.airline == 2.0 %}
                                                            <p>Go First</p>
                                                        {% elif fl_details.airline == 3.0 %}
                                                            <p>indigo</p>
                                                        {% elif fl_details.airline == 4.0 %}
                                                            <p>Spice Jet</p>
                                                        {% elif fl_details.airline == 5.0 %}
                                                            <p>Vistara</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Source</label>
                                                    <div class="form-field">
                                                        <select name="source_city" id="" class="form-control">
                                                            <option value="{{fl_details.source_city}}">{{fl_details.source_city}}</option>
                                                        </select>
                                                        {% if fl_details.source_city == 0.0 %}
                                                            <p>Bangalore</p>
                                                        {% elif fl_details.source_city == 1.0 %}
                                                            <p>Chennai</p>
                                                        {% elif fl_details.source_city == 2.0 %}
                                                            <p>Delhi</p>
                                                        {% elif fl_details.source_city == 3.0 %}
                                                            <p>Hyderabad</p>
                                                        {% elif fl_details.source_city == 4.0 %}
                                                            <p>Kolkata</p>
                                                        {% elif fl_details.source_city == 5.0 %}
                                                            <p>Mumbai</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Departure Time</label>
                                                    <div class="form-field">
                                                        <select name="departure_time" id="" class="form-control">
                                                            <option value="{{fl_details.departure_time}}">{{fl_details.departure_time}}</option>
                                                        </select>
                                                        {% if fl_details.departure_time == 0.0 %}
                                                            <p>Afternoon</p>
                                                        {% elif fl_details.departure_time == 1.0 %}
                                                            <p>Early Morning</p>
                                                        {% elif fl_details.departure_time == 2.0 %}
                                                            <p>Evening</p>
                                                        {% elif fl_details.departure_time == 3.0 %}
                                                            <p>Late Night</p>
                                                        {% elif fl_details.departure_time == 4.0 %}
                                                            <p>Morning</p>
                                                        {% elif fl_details.departure_time == 5.0 %}
                                                            <p>Night</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Stops</label>
                                                    <div class="form-field">
                                                        <select name="stops" id="" class="form-control">
                                                            <option value="{{fl_details.stops}}">{{fl_details.stops}}</option>
                                                        </select>
                                                        {% if fl_details.stops == 0.0 %}
                                                            <p>Zero</p>
                                                        {% elif fl_details.stops == 1.0 %}
                                                            <p>One</p>
                                                        {% elif fl_details.stops == 2.0 %}
                                                            <p>Two or More</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Arrival Time</label>
                                                    <div class="form-field">
                                                        <select name="arrival_time" id="" class="form-control">
                                                            <option value="{{fl_details.arrival_time}}">{{fl_details.arrival_time}}</option>
                                                        </select>
                                                        {% if fl_details.arrival_time == 0.0 %}
                                                            <p>Afternoon</p>
                                                        {% elif fl_details.arrival_time == 1.0 %}
                                                            <p>Early Morning</p>
                                                        {% elif fl_details.arrival_time == 2.0 %}
                                                            <p>Evening</p>
                                                        {% elif fl_details.arrival_time == 3.0 %}
                                                            <p>Late Night</p>
                                                        {% elif fl_details.arrival_time == 4.0 %}
                                                            <p>Morning</p>
                                                        {% elif fl_details.arrival_time == 5.0 %}
                                                            <p>Night</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12 tab-wrap mt-3">
                            <div class="tab-content" id="v-pills-tabContent">
                                <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel" aria-labelledby="v-pills-nextgen-tab">
                                    <div action="#" class="search-property-1">
                                        <div class="row no-gutters">

                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Destination</label>
                                                    <div class="form-field">
                                                        <select name="destination_city" id="" class="form-control">
                                                            
                                                            <option value="{{fl_details.destination_city}}">{{fl_details.destination_city}}</option>
                                                        </select>
                                                        {% if fl_details.destination_city == 0.0 %}
                                                        <p>Bangalore</p>
                                                        {% elif fl_details.destination_city == 1.0 %}
                                                            <p>Chennai</p>
                                                        {% elif fl_details.destination_city == 2.0 %}
                                                            <p>Delhi</p>
                                                        {% elif fl_details.destination_city == 3.0 %}
                                                            <p>Hyderabad</p>
                                                        {% elif fl_details.destination_city == 4.0 %}
                                                            <p>Kolkata</p>
                                                        {% elif fl_details.destination_city == 5.0 %}
                                                            <p>Mumbai</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Class</label>
                                                    <div class="form-field">
                                                        <select name="flight_class" id="" class="form-control">
                                                            <option value="{{fl_details.class}}">{{fl_details.class}}</option>
                                                        </select>
                                                        {% if fl_details.class == 0.0 %}
                                                            <p>Business Class</p>
                                                        {% elif fl_details.class == 1.0 %}
                                                            <p>Economic Class</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Duration(Hours)</label>
                                                    <div class="form-field">
                                                        <input type="text" class="form-control" name="duration" value = "{{fl_details.duration}}" placeholder="Duration">
                                                        <p>{{fl_details.duration}} hours</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            
                                            <div class="col-md d-flex">
                                                <div class="form-group p-4">
                                                    <label for="#">Days from today</label>
                                                    <div class="form-field">
                                                        <input 
                                                            type="text" 
                                                            class="form-control daysLeftInput" 
                                                            id="daysLeftInput{{ forloop.counter }}" 
                                                            name="days_left" 
                                                            value="{{ fl_details.days_left }}" 
                                                            placeholder="Days from today">
                                                        <p id="calculatedDate{{ forloop.counter }}" class="fw-bold text-danger"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg d-flex">
                                                <div class="form-group d-flex w-100 border-0">
                                                    <div class="form-field w-100 align-items-center d-flex">
                                                        <button type="submit" class="align-self-stretch form-control btn btn-primary p-0">Predict Price</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                {% endfor %}
            {% else %}
            <div class="text-center">
                <h1 class="text-danger">No Flights Available</h1>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Select all daysLeftInput elements
            const inputs = document.querySelectorAll(".daysLeftInput");
        
            // Loop through inputs and calculate dates
            inputs.forEach((input, index) => {
                const calculatedDateElement = document.getElementById(`calculatedDate${index + 1}`);
        
                // Function to calculate and update date
                const updateDate = () => {
                    const daysLeft = parseInt(input.value, 10);
                    if (!isNaN(daysLeft)) {
                        const currentDate = new Date();
                        currentDate.setDate(currentDate.getDate() + daysLeft);
        
                        // Format date as YYYY-MM-DD
                        const formattedDate = currentDate.toISOString().split("T")[0];
                        calculatedDateElement.textContent = `${formattedDate}`;
                    } else {
                        calculatedDateElement.textContent = "Invalid days_left value";
                    }
                };
        
                // Initialize calculation
                updateDate();
        
                // Add event listener for dynamic updates
                input.addEventListener("input", updateDate);
            });
        });
    </script>
</section>

{% endblock %}